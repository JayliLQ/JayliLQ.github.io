{"title":"DNS 协议","date":"2019-06-25T14:49:24.000Z","date_formatted":{"ll":"2019年6月25日","L":"2019/06/25","MM-DD":"06-25"},"link":"2019/06/25/18. DNS协议","tags":["网络协议"],"categories":["网络协议"],"updated":"2019-12-01T14:57:47.569Z","content":"<!-- build time:Sun Aug 23 2020 21:12:13 GMT+0800 (GMT+08:00) --><h2 id=\"DNS（Domain-Name-System）服务器\">DNS（Domain Name System）服务器<a href=\"2019/06/25/18. DNS协议#DNS（Domain-Name-System）服务器\"></a></h2><p>需要高可用，高并发，分布式，于是，有了数状的层次结构</p><p><img src=\"https://static001.geekbang.org/resource/image/59/a6/59f79cba26904ff721aabfcdc0c27da6.jpg\" alt=\"DNS结构\" class=\"article-img\"></p><p>根 DNS 服务器：返回顶级域 DNS 服务器的 IP 地址</p><p>顶级域 DNS 服务器：返回权威 DNS 服务器的 IP 地址</p><p>权威 DNS 服务器：返回相应主机的 IP 地址</p><h2 id=\"DNS-解析流程\">DNS 解析流程<a href=\"2019/06/25/18. DNS协议#DNS-解析流程\"></a></h2><p><img src=\"https://static001.geekbang.org/resource/image/ff/f2/ff7e8f824ebd1f7e16ef5d70cd79bdf2.jpg\" alt=\"DNS 解析流程\" class=\"article-img\"></p><p>本地 DNS 服务器由网络服务商（ISP），如电信，移动等自动分配，它通常就在网络服务商的某个机房</p><h2 id=\"负载均衡\">负载均衡<a href=\"2019/06/25/18. DNS协议#负载均衡\"></a></h2><ul><li><p>内部负载均衡</p><p>在域名解析的时候，配置策略，返回不同的 IP 地址</p></li><li><p>全局负载均衡（GSLB，Global Server Load Balance）</p></li></ul><p><img src=\"https://static001.geekbang.org/resource/image/56/d1/569ddad1a0c5a5f60341fbe023b47cd1.jpg\" alt=\"\" class=\"article-img\"></p><p>对不需要做全局负载均衡的简单应用，yourcompany.com 的权威 DNS 服务器可以直接将 object.yourcompany.com 这个域名解析为一个或者多个 IP 地址，然后客户端通过多个 IP 地址，进行简单的轮训，实现简单的负载均衡</p><p>对于复杂的应用，尤其是跨地域跨运营商的大型应用，则需要更加复杂的全局网络负载均衡机制，因此需要专门的设备或者服务器来做这件事情，这就是全局负载均衡器（GSLB）</p><ol><li>图中第一层 GSLB，通过查看请求它的本地 DNS 服务器所在的运营商，得知用户所在的运营商。假设是移动，通过 CNAME 的方式，通过另一个别名 object.yd.yourcompany.com，盖住本地 DNS 服务器去请求第二层的 GSLB</li><li>第二层 GSLB，通过查看请求它的本地 DNS 服务器所在的地址，就知道用户所在的地理位置，然后将距离用户位置比较近的 Region 里面，六个内部负载均衡（SLB，Server Load Balancer）的地址返回给本地 DNS 服务器</li><li>本地 DNS 服务器将结果返回给本地 DNS 解析器</li><li>本地 DNS 解析器将结果缓存后，返回给客户端</li><li>客户端开始访问属于相同运营商的距离较近的 Region 1 中的对象存储，当然客户端得到了六个 IP 地址，它可以通过负载均衡的方式，随机或者轮询选择一个可用区进行访问。对象存储一般会有三个备份，从而可以实现对存储读写的负载均衡</li></ol><h2 id=\"小结\">小结<a href=\"2019/06/25/18. DNS协议#小结\"></a></h2><ul><li>DNS 是网络世界的地址簿，可以通过域名查地址，因为域名服务器是按照树状结构组织的，因而域名查找是使用递归的方法，并通过缓存的方式增强性能</li><li>在域名和 IP 的映射过程中，给了应用基于域名做负载均衡的机会，可以是简单的负载均衡，也可以根据地址和运营商做全局的负载均衡</li></ul><h2 id=\"思考\">思考<a href=\"2019/06/25/18. DNS协议#思考\"></a></h2><ul><li>全局负载均衡为什么要分地址和运营商呢？</li><li>全局负载均衡使用过程中，常常遇到失灵的情况吗？对应应该怎么来解决呢？</li></ul><!-- rebuild by neat -->","prev":{"title":"数据中心","link":"2019/06/25/21. 数据中心"},"next":{"title":"云中的网络Qos","link":"2019/06/25/27. 云中的网络QoS"},"plink":"https://www.jayli.cn/2019/06/25/18. DNS协议/","toc":[{"title":"DNS（Domain Name System）服务器","id":"DNS（Domain-Name-System）服务器","index":"1"},{"title":"DNS 解析流程","id":"DNS-解析流程","index":"2"},{"title":"负载均衡","id":"负载均衡","index":"3"},{"title":"小结","id":"小结","index":"4"},{"title":"思考","id":"思考","index":"5"}],"copyright":{"link":"<a href=\"https://www.jayli.cn/2019/06/25/18. DNS协议/\" title=\"DNS 协议\">https://www.jayli.cn/2019/06/25/18. DNS协议/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"2019年6月25日","author":"Jayli"}}