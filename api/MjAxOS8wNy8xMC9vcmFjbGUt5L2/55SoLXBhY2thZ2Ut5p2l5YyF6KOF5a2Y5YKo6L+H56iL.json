{"title":"oracle 使用 package 来包装存储过程","date":"2019-07-10T14:45:01.000Z","date_formatted":{"ll":"2019年7月10日","L":"2019/07/10","MM-DD":"07-10"},"link":"2019/07/10/oracle-使用-package-来包装存储过程","tags":["数据库"],"updated":"2019-12-02T14:47:48.559Z","content":"<!-- build time:Sun Aug 23 2020 20:59:40 GMT+0800 (GMT+08:00) --><a id=\"more\"></a><p>oracle使用package来包装存储过程</p><p><strong>为什么使用 package</strong><br>如果是存储过程或者function数量比较多维护起来就麻烦了，存储过程或者function单独建名称是不允许重复的，有时还会误删引起不必要的麻烦。<br>oracle也提供了package这种机制来处理这种问题，package和java里的那个很相似，里面既可以定义存储过程还可以定义function,package由包头和包体两部分组成。</p><ol><li><p>包头部分，主要是包的定义以及存储过程声明</p><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">create <span class=\"keyword\">or</span> replace package user_control <span class=\"keyword\">As</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">procedure</span> <span class=\"title\">insert_user</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">fid <span class=\"keyword\">In</span> user.id%<span class=\"keyword\">TYPE</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">fname <span class=\"keyword\">In</span> user.<span class=\"keyword\">name</span>%<span class=\"keyword\">TYPE</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">fout <span class=\"keyword\">Out</span> varchar2</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">)</span>;</span>  </span><br><span class=\"line\"><span class=\"keyword\">End</span> user_control;</span><br></pre></td></tr></table></div></figure></li><li><p>包体部分，主要是存储过程的具体实现，创建包体的时候注意包体的名称和包的名称一致</p><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">create <span class=\"keyword\">or</span> replace package user_control <span class=\"keyword\">As</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">procedure</span> <span class=\"title\">insert_user</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">fid <span class=\"keyword\">In</span> user.id%<span class=\"keyword\">TYPE</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">fname <span class=\"keyword\">In</span> user.<span class=\"keyword\">name</span>%<span class=\"keyword\">TYPE</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">fout <span class=\"keyword\">Out</span> varchar2</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">)</span><span class=\"title\">IS</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">begin</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">insert</span> <span class=\"title\">into</span> <span class=\"title\">user</span><span class=\"params\">(id,<span class=\"keyword\">name</span>)</span> <span class=\"title\">values</span><span class=\"params\">(fid,fname)</span>;</span></span><br><span class=\"line\">fout := <span class=\"string\">'1'</span>;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"><span class=\"keyword\">end</span> user_control;</span><br></pre></td></tr></table></div></figure></li><li><p>调用存储过程，包名.存储过程名(参数列表)</p><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">oracle调用：</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"keyword\">declare</span></span><br><span class=\"line\"> fout varchar2(<span class=\"number\">2</span>);</span><br><span class=\"line\"> <span class=\"keyword\">begin</span></span><br><span class=\"line\"> user_control.insert_user('<span class=\"number\">001</span><span class=\"string\">','</span>jack',fout);</span><br><span class=\"line\"> <span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"> mybatis调用：</span><br><span class=\"line\"> </span><br><span class=\"line\"> &lt;<span class=\"keyword\">select</span> id=<span class=\"string\">\"insertUser\"</span> statementType=<span class=\"string\">\"CALLABLE\"</span> parameterType=<span class=\"string\">\"java.util.Map\"</span>&gt; </span><br><span class=\"line\">             &#123;call user_control.insert_user(#&#123;fid,mode=<span class=\"keyword\">IN</span>,jdbcType=VARCHAR&#125;,#&#123;fname,mode=<span class=\"keyword\">IN</span>,jdbcType=VARCHAR&#125;,#&#123;fout,mode=<span class=\"keyword\">OUT</span>,jdbcType=VARCHAR&#125;)&#125; </span><br><span class=\"line\"> &lt;/<span class=\"keyword\">select</span>&gt;</span><br></pre></td></tr></table></div></figure></li></ol><!-- rebuild by neat -->","prev":{"title":"Spring Boot 笔记","link":"2019/08/02/Spring Boot 笔记"},"next":{"title":"VUE Errors","link":"2019/07/01/VUE-Errors"},"plink":"https://www.jayli.cn/2019/07/10/oracle-使用-package-来包装存储过程/","copyright":{"link":"<a href=\"https://www.jayli.cn/2019/07/10/oracle-使用-package-来包装存储过程/\" title=\"oracle 使用 package 来包装存储过程\">https://www.jayli.cn/2019/07/10/oracle-使用-package-来包装存储过程/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"2019年7月10日","author":"Jayli"}}