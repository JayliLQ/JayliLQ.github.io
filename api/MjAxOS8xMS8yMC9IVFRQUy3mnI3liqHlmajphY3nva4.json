{"title":"HTTPS 服务器配置","date":"2019-11-20T15:03:59.000Z","date_formatted":{"ll":"2019年11月20日","L":"2019/11/20","MM-DD":"11-20"},"link":"2019/11/20/HTTPS-服务器配置","tags":["网络协议,Nginx"],"categories":["网络协议"],"updated":"2019-12-01T15:06:18.789Z","content":"<!-- build time:Sun Aug 23 2020 20:59:40 GMT+0800 (GMT+08:00) --><p>HTTPS 在 Nginx 上的配置。</p><a id=\"more\"></a><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\"><span class=\"attribute\">listen</span>       <span class=\"number\">443</span>;   <span class=\"comment\">#指定ssl监听端口</span></span><br><span class=\"line\"><span class=\"attribute\">server_name</span>  www.example.com;</span><br><span class=\"line\"><span class=\"attribute\">ssl</span> <span class=\"literal\">on</span>;    <span class=\"comment\">#开启ssl支持</span></span><br><span class=\"line\"><span class=\"attribute\">ssl_certificate</span>      /etc/nginx/server.pem;    <span class=\"comment\">#指定服务器证书路径</span></span><br><span class=\"line\"><span class=\"attribute\">ssl_certificate_key</span>  /etc/nginx/server.key;    <span class=\"comment\">#指定私钥证书路径</span></span><br><span class=\"line\"><span class=\"attribute\">ssl_session_timeout</span>  <span class=\"number\">5m</span>;</span><br><span class=\"line\"><span class=\"attribute\">ssl_protocols</span> TLSv1 TLSv1.<span class=\"number\">1</span> TLSv1.<span class=\"number\">2</span>;     <span class=\"comment\">#指定SSL服务器端支持的协议版本</span></span><br><span class=\"line\"><span class=\"attribute\">ssl_ciphers</span>  ALL：!ADH：!EXPORT56：RC4+RSA：+HIGH：+MEDIUM：+LOW：+SSLv2：+EXP;    <span class=\"comment\">#指定加密算法</span></span><br><span class=\"line\"><span class=\"attribute\">ssl_prefer_server_ciphers</span>   <span class=\"literal\">on</span>;    <span class=\"comment\">#在使用SSLv3和TLS协议时指定服务器的加密算法要优先于客户端的加密算法</span></span><br><span class=\"line\"><span class=\"comment\">#以下内容请按域名需要进行配置，此处仅供参考</span></span><br><span class=\"line\"><span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\"><span class=\"attribute\">return</span> <span class=\"number\">444</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure><p>Openssl提供了简单的client和server工具，可以用来模拟SSL连接，做测试使用。</p><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># 连接到远程服务器</span></span><br><span class=\"line\">&gt; openssl s_client -connect www.google.com.hk:<span class=\"number\">443</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 模拟的HTTPS服务，可以返回Openssl相关信息 </span></span><br><span class=\"line\"><span class=\"meta\"># -accept 用来指定监听的端口号 </span></span><br><span class=\"line\"><span class=\"meta\"># -cert -key 用来指定提供服务的key和证书</span></span><br><span class=\"line\">&gt; openssl s_server -accept <span class=\"number\">443</span> -cert myserver.crt -key myserver.key -www</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 可以将key和证书写到同一个文件中</span></span><br><span class=\"line\">&gt; cat myserver.crt myserver.key &gt; myserver.pem</span><br><span class=\"line\"><span class=\"meta\"># 使用的时候只提供一个参数就可以了</span></span><br><span class=\"line\">&gt; openssl s_server -accept <span class=\"number\">443</span> -cert myserver.pem -www</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># 可以将服务器的证书保存下来</span></span><br><span class=\"line\">&gt; openssl s_client -connect www.google.com.hk:<span class=\"number\">443</span> &lt;/dev/<span class=\"literal\">null</span> | sed -ne <span class=\"string\">'/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p'</span> &gt; remoteserver.pem</span><br><span class=\"line\"><span class=\"meta\"># 转换成DER文件，就可以在Windows下直接查看了</span></span><br><span class=\"line\">&gt; openssl x509 -outform der -in remoteserver.pem -out remoteserver.cer</span><br></pre></td></tr></table></div></figure><p>测试 ssl 连接：<br><code>openssl s_client -connect b2bit.huaqin.com:10443</code></p><p>参考：</p><ol><li><a href=\"https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=10_4\" target=\"_blank\" rel=\"noopener\">微信开发文档 HTTPS 服务器配置</a></li><li><a href=\"https://blog.csdn.net/honeying/article/details/79067518\" target=\"_blank\" rel=\"noopener\">openssl 证书操作命令</a></li></ol><!-- rebuild by neat -->","prev":{"title":"EasyExcel插入指定大小图片","link":"2019/11/25/EasyExcel插入指定大小图片"},"next":{"title":"操作系统 IO 模型","link":"2019/11/15/操作系统-IO-模型"},"plink":"https://www.jayli.cn/2019/11/20/HTTPS-服务器配置/","copyright":{"link":"<a href=\"https://www.jayli.cn/2019/11/20/HTTPS-服务器配置/\" title=\"HTTPS 服务器配置\">https://www.jayli.cn/2019/11/20/HTTPS-服务器配置/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"2019年11月20日","author":"Jayli"}}