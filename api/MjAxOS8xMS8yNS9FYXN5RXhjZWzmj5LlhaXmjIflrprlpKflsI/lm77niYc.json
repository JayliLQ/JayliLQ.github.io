{"title":"EasyExcel插入指定大小图片","date":"2019-11-25T14:37:11.000Z","date_formatted":{"ll":"2019年11月25日","L":"2019/11/25","MM-DD":"11-25"},"link":"2019/11/25/EasyExcel插入指定大小图片","tags":["Java"],"categories":["Java"],"updated":"2019-12-01T14:39:18.878Z","content":"<!-- build time:Sun Aug 23 2020 21:12:13 GMT+0800 (GMT+08:00) --><p>用 EasyExcel 填充模板时，插入的图片会被压缩到一个单元格的大小。指定图片大小的解决方法如下：<br><a id=\"more\"></a></p><ol><li>将内容填充进模板</li></ol><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">ExcelWriter</span> excelWriter = <span class=\"type\">EasyExcel</span>.write(fileName).withTemplate(templateFileName).registerWriteHandler(<span class=\"function\"><span class=\"keyword\">new</span> <span class=\"title\">imageEnhance</span>()).<span class=\"title\">build</span>();</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">WriteSheet</span> <span class=\"title\">writeSheet</span> = <span class=\"title\">EasyExcel</span>.<span class=\"title\">writerSheet</span>().<span class=\"title\">build</span>();</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">FillConfig</span> <span class=\"title\">fillConfig</span> = <span class=\"title\">FillConfig</span>.<span class=\"title\">builder</span>().<span class=\"title\">forceNewRow</span>(<span class=\"type\">Boolean</span>.<span class=\"type\">TRUE</span>).<span class=\"title\">build</span>();</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">Map</span>&lt;<span class=\"title\">String</span>, <span class=\"title\">Object</span>&gt; <span class=\"title\">map</span> = <span class=\"title\">new</span> <span class=\"title\">HashMap</span>&lt;&gt;();</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">byte</span>[] <span class=\"title\">signature</span> = <span class=\"title\">FileUtils</span>.<span class=\"title\">readFileToByteArray</span>(<span class=\"type\">ResourceUtils</span>.getFile(\"classpath:testImg.png\"));</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">map</span>.<span class=\"title\">put</span>(\"signature\", signature);</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">excelWriter</span>.<span class=\"title\">fill</span>(map, fillConfig, writeSheet);</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">excelWriter</span>.<span class=\"title\">finish</span>();</span></span><br></pre></td></tr></table></div></figure><ol start=\"2\"><li>注入灵魂…</li></ol><pre><code>class imageEnhance implements CellWriteHandler {\n\n    @Override\n    public void beforeCellCreate(WriteSheetHolder writeSheetHolder, WriteTableHolder writeTableHolder, Row row, Head head, Integer integer, Integer integer1, Boolean aBoolean) {}\n\n    @Override\n    public void afterCellCreate(WriteSheetHolder writeSheetHolder, WriteTableHolder writeTableHolder, Cell cell, Head head, Integer integer, Boolean aBoolean) {}\n\n    @Override\n    public void afterCellDispose(WriteSheetHolder writeSheetHolder, WriteTableHolder writeTableHolder, List&lt;CellData&gt; list, Cell cell, Head head, Integer integer, Boolean aBoolean) {\n        int curRowIndex = cell.getRowIndex();\n        int curColIndex = cell.getColumnIndex();\n        CellData cellData = list.get(0);\n        if (CellDataTypeEnum.IMAGE.equals(cellData.getType())) {\n            Workbook wb = writeSheetHolder.getParentWriteWorkbookHolder().getWorkbook();\n            Drawing&lt;?&gt; patriarch = writeSheetHolder.getSheet().createDrawingPatriarch();\n            ClientAnchor anchor = new XSSFClientAnchor(0, 0, 0, 0, (short) curColIndex, curRowIndex, (short) curColIndex + 3, curRowIndex + 6);\n            anchor.setAnchorType(ClientAnchor.AnchorType.DONT_MOVE_AND_RESIZE);\n            byte[] imgByte = list.get(0).getImageValue();\n            patriarch.createPicture(anchor, wb.addPicture(imgByte, HSSFWorkbook.PICTURE_TYPE_PNG));\n        }\n    }\n</code></pre><!-- rebuild by neat -->","prev":{"title":"Tomcat 原理","link":"2019/11/26/Tomcat"},"next":{"title":"HTTPS 服务器配置","link":"2019/11/20/HTTPS-服务器配置"},"plink":"https://www.jayli.cn/2019/11/25/EasyExcel插入指定大小图片/","copyright":{"link":"<a href=\"https://www.jayli.cn/2019/11/25/EasyExcel插入指定大小图片/\" title=\"EasyExcel插入指定大小图片\">https://www.jayli.cn/2019/11/25/EasyExcel插入指定大小图片/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"2019年11月25日","author":"Jayli"}}